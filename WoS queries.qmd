---
title: "WoS queries"
author: "Théophile L. Mouton"
date: "February 13, 2026"
format:
  html:
    toc: true
    toc-location: right
    css: custom.css
    output-file: "WoS queries.html"
    self-contained: true
    code-fold: true
    code-tools: true
editor: visual
execute:
  warning: false
  message: false
  echo: true
---

## R packages

```{r}
library(bibliometrix)
library(tidyverse)
```

## Import WoS records

Single Web of Science query performed (13/02/2026):

TS=(
  ("ecosystem model*" OR "food web model*" OR "bioeconomic model*"
   OR "bio-economic model*" OR "end-to-end model*" OR "trophic model*"
   OR "socio-ecological model*" OR "social-ecological model*"
   OR "socioecological model*" OR "species distribution model*"
   OR "spatially explicit model*" OR "biogeochemical model*"
   OR "earth system model*" OR "fisheries model*"
   OR "qualitative model*" OR "habitat model*"
   OR "connectivity model*")
  AND
  ("protected area*" OR "no-take zone*"
   OR "conservation planning" OR "spatial planning"
   OR "area-based management"
   OR "zonation" OR "zoning" OR "prioriti?ation"
   OR "reserve design" OR "reserve network" OR "site selection"
   OR "fisheries management" OR "ecosystem-based management"
   OR "decision support" OR "decision making"
   OR "management strategy evaluation"
   OR "socio-ecological" OR "social-ecological" OR "socioecological"
   OR "ecosystem approach" OR "adaptive management"
   OR "trade-off*" OR "optimi?ation"
   OR "cost-effectiveness" OR "cost-benefit"
   OR "impact assessment" OR "ecosystem service*"
   OR "risk assessment")
  AND
  ("marine" OR "ocean*" OR "coastal" OR "fish*"
   OR "reef*" OR "pelagic" OR "sea"
   OR "seagrass" OR "mangrove" OR "lagoon*"
   OR "estuar*" OR "benthic" OR "shore*" OR "intertidal")
)

Results: 3,715 articles.

```{r}
#| output: false
#| results: hide

# Import 8 WoS export files
wos_files <- paste0("WoS_query_", 1:8, ".txt")

wos_list <- lapply(wos_files, function(f) {
  convert2df(here::here("WoS_query_130226", f), dbsource = "wos", format = "plaintext")
})

all_wos <- bind_rows(wos_list) |> distinct(DI, .keep_all = TRUE)
```

```{r}
cat("Total after deduplication:", nrow(all_wos), "\n")
```

## Filter queries (Year, Citations)

```{r}
# Distribution par année
year_dist <- all_wos |> count(PY) |> arrange(PY)
#print(as.data.frame(year_dist), row.names = FALSE)

# Ou simplement
#table(all_wos$PY)

# Filtre temporel : 2010+
all_wos_2010 <- all_wos |> filter(PY >= 2010)
cat("Après filtre 2010+:", nrow(all_wos_2010), "\n")

# Distribution des citations
#summary(all_wos_2010$TC)

# Tester différents seuils de citations
thresholds <- c(5, 10, 20, 30, 50, 100)
for (t in thresholds) {
  n <- all_wos_2010 |> filter(TC >= t) |> nrow()
  cat("Citations >=", t, ":", n, "papers\n")
}

# Combined filter: >=30 citations OR recent (2023-2025) with >=5 citations
final_wos <- all_wos_2010 |>
  filter(
    TC >= 30 | (PY >= 2023 & TC >= 5)
  )

cat("Final set:", nrow(final_wos), "\n")

# Composition du dataset final
final_wos |>
  mutate(category = if_else(PY >= 2023, "Recent (2023-25, ≥5 cites)", "Highly cited (≥30)")) |>
  count(category)

# Top articles les plus cités
#final_wos |>
#  arrange(desc(TC)) |>
#  select(TI, PY, TC, SO, query_source) |>
#  head(15)
```

# Geographic biais analysis 

```{r}
# Extraire les pays avec metaTagExtraction
final_wos <- metaTagExtraction(final_wos, Field = "AU_CO", sep = ";")
all_wos_2010 <- metaTagExtraction(all_wos_2010, Field = "AU_CO", sep = ";")

# Créer le dataframe countries (APRÈS filtre)
countries <- final_wos |>
  select(DI, PY, TC, AU_CO) |>
  filter(!is.na(AU_CO)) |>
  separate_rows(AU_CO, sep = ";") |>
  mutate(AU_CO = str_trim(AU_CO)) |>
  filter(AU_CO != "")

# Créer le dataframe countries_before (AVANT filtre citations)
countries_before <- all_wos_2010 |>
  select(DI, PY, TC, AU_CO) |>
  filter(!is.na(AU_CO)) |>
  separate_rows(AU_CO, sep = ";") |>
  mutate(AU_CO = str_trim(AU_CO)) |>
  filter(AU_CO != "")

# Top 20 pays
#countries |> count(AU_CO, sort = TRUE) |> head(20)

# Liste des pays du Sud global
global_south <- c(
  # Afrique
  "ALGERIA", "ANGOLA", "BENIN", "BOTSWANA", "BURKINA FASO", "BURUNDI", "CAMEROON",
  "CAPE VERDE", "CENTRAL AFRICAN REPUBLIC", "CHAD", "COMOROS", "CONGO", "COTE IVOIRE",
  "DEMOCRATIC REPUBLIC OF THE CONGO", "DJIBOUTI", "EGYPT", "EQUATORIAL GUINEA", 
  "ERITREA", "ESWATINI", "ETHIOPIA", "GABON", "GAMBIA", "GHANA", "GUINEA", "KENYA",
  "LESOTHO", "LIBERIA", "LIBYA", "MADAGASCAR", "MALAWI", "MALI", "MAURITANIA",
  "MAURITIUS", "MOROCCO", "MOZAMBIQUE", "NAMIBIA", "NIGER", "NIGERIA", "RWANDA",
  "SENEGAL", "SEYCHELLES", "SIERRA LEONE", "SOMALIA", "SOUTH AFRICA", "SOUTH SUDAN",
  "SUDAN", "TANZANIA", "TOGO", "TUNISIA", "UGANDA", "ZAMBIA", "ZIMBABWE",
  # Amérique latine & Caraïbes
  "ARGENTINA", "BAHAMAS", "BARBADOS", "BELIZE", "BOLIVIA", "BRAZIL", "CHILE",
  "COLOMBIA", "COSTA RICA", "CUBA", "DOMINICAN REPUBLIC", "ECUADOR", "EL SALVADOR",
  "GUATEMALA", "GUYANA", "HAITI", "HONDURAS", "JAMAICA", "MEXICO", "NICARAGUA",
  "PANAMA", "PARAGUAY", "PERU", "SURINAME", "TRINIDAD AND TOBAGO", "URUGUAY", "VENEZUELA",
  # Asie du Sud et du Sud-Est
  "AFGHANISTAN", "BANGLADESH", "BHUTAN", "CAMBODIA", "INDIA", "INDONESIA", "LAOS",
  "MALAYSIA", "MALDIVES", "MYANMAR", "NEPAL", "PAKISTAN", "PHILIPPINES", "SRI LANKA",
  "THAILAND", "TIMOR-LESTE", "VIETNAM",
  # Moyen-Orient
  "IRAN", "IRAQ", "JORDAN", "LEBANON", "PALESTINE", "SYRIA", "YEMEN",
  # Asie centrale
  "KAZAKHSTAN", "KYRGYZSTAN", "TAJIKISTAN", "TURKMENISTAN", "UZBEKISTAN", "MONGOLIA",
  # Pacifique
  "FIJI", "PAPUA NEW GUINEA", "SAMOA", "SOLOMON ISLANDS", "TONGA", "VANUATU",
  "NEW CALEDONIA", "FRENCH POLYNESIA"
)

# Analyse plus fine de la composition des articles
articles_detailed <- countries |>
  mutate(region = if_else(AU_CO %in% global_south, "South", "North")) |>
  group_by(DI) |>
  summarise(
    n_countries = n_distinct(AU_CO),
    n_south = sum(region == "South"),
    n_north = sum(region == "North"),
    pct_south = round(100 * n_south / (n_south + n_north), 1),
    .groups = "drop"
  ) |>
  mutate(
    category = case_when(
      pct_south == 100 ~ "Sud uniquement",
      pct_south >= 50 ~ "Majorité Sud",
      pct_south > 0 ~ "Minorité Sud (collab)",
      TRUE ~ "Nord uniquement"
    )
  )

# Distribution des catégories
articles_detailed |> count(category)

# Même analyse AVANT le filtre citations
articles_before <- countries_before |>
  mutate(region = if_else(AU_CO %in% global_south, "South", "North")) |>
  group_by(DI) |>
  summarise(
    n_south = sum(region == "South"),
    n_north = sum(region == "North"),
    pct_south = round(100 * n_south / (n_south + n_north), 1),
    .groups = "drop"
  ) |>
  mutate(
    category = case_when(
      pct_south == 100 ~ "Sud uniquement",
      pct_south >= 50 ~ "Majorité Sud",
      pct_south > 0 ~ "Minorité Sud (collab)",
      TRUE ~ "Nord uniquement"
    )
  )

# Comparer avant/après
comparison <- bind_rows(
  articles_before |> count(category) |> mutate(dataset = "Avant filtre"),
  articles_detailed |> count(category) |> mutate(dataset = "Après filtre")
) |>
  group_by(dataset) |>
  mutate(pct = round(100 * n / sum(n), 1)) |>
  select(dataset, category, n, pct) |>
  pivot_wider(names_from = dataset, values_from = c(n, pct))

print(comparison, width = Inf)

# Fusionner la catégorie avec le dataset complet
all_wos_2010 <- all_wos_2010 |>
  left_join(articles_before |> select(DI, category, pct_south), by = "DI")
```

Correction du biais géographique

L'analyse de la distribution géographique des auteurs révèle que le filtre de citations standard (≥30 citations ou ≥5 pour les articles récents) exclut disproportionnellement les publications du Sud global. Les articles sans co-auteur du Nord ("Sud uniquement") voient leur représentation chuter de 5.8% à 3.0% après filtrage - une baisse relative de 48%. Les articles à majorité Sud passent de 5.4% à 3.9% (-28%).

Pour corriger ce biais structurel, nous appliquons des seuils de citations différenciés selon la composition géographique des auteurs :

| Catégorie | Critères d'inclusion |
|-----------|---------------------|
| **Nord uniquement** | ≥30 citations, ou ≥5 si publié 2023-2025 |
| **Minorité Sud (collaboration)** | ≥30 citations, ou ≥5 si publié 2023-2025 |
| **Majorité Sud** | ≥10 citations, ou ≥2 si publié 2023-2025 |
| **Sud uniquement** | ≥10 citations, ou ≥2 si publié 2023-2025 |

Cette approche reconnaît que les articles issus du Sud global accumulent structurellement moins de citations en raison de barrières linguistiques, d'effets de réseau, et de la hiérarchie des revues scientifiques.

```{r}
# Filtre ajusté : seuil réduit pour les articles authentiquement du Sud
final_wos_adjusted <- all_wos_2010 |>
  filter(
    # Critères standards pour le Nord et collaborations
    (category %in% c("Nord uniquement", "Minorité Sud (collab)") & 
       (TC >= 30 | (PY >= 2023 & TC >= 5))) |
    # Seuil réduit pour Sud uniquement et Majorité Sud
    (category %in% c("Sud uniquement", "Majorité Sud") & 
       (TC >= 10 | (PY >= 2023 & TC >= 2)))
  )
```

# Filtering by WoS category (domain/topic)

```{r}
# Voir les champs disponibles liés aux catégories
names(final_wos_adjusted)[grep("WC|SC|CA", names(final_wos_adjusted))]

# WC = Web of Science Categories
# SC = Research Areas

# Distribution des catégories WoS
final_wos_adjusted |>
  separate_rows(WC, sep = ";") |>
  mutate(WC = str_trim(WC)) |>
  count(WC, sort = TRUE) |>
  head(30) |>
  print(n = 30)

# Version élargie
relevant_categories <- c(
  "ENVIRONMENTAL SCIENCES",
  "ECOLOGY",
  "BIODIVERSITY CONSERVATION",
  "MARINE & FRESHWATER BIOLOGY",
  "OCEANOGRAPHY",
  "FISHERIES",
  "ENVIRONMENTAL STUDIES",
  "WATER RESOURCES",
  "MULTIDISCIPLINARY SCIENCES",
  "LIMNOLOGY",
  "ZOOLOGY",
  "ENGINEERING, OCEAN",
  "ENGINEERING, MARINE",
  "REMOTE SENSING",
  "GEOSCIENCES, MULTIDISCIPLINARY",
  "GEOGRAPHY, PHYSICAL",
  "GREEN & SUSTAINABLE SCIENCE & TECHNOLOGY",
  "INTERNATIONAL RELATIONS",
  "ECONOMICS",
  "BIOLOGY"
)

final_filtered <- final_wos_adjusted |>
  filter(str_detect(WC, paste(relevant_categories, collapse = "|")))

cat("Before category filter:", nrow(final_wos_adjusted), "\n")
cat("After category filter:", nrow(final_filtered), "\n")
cat("Lost:", nrow(final_wos_adjusted) - nrow(final_filtered), "\n")

# Vérifier ce qu'on perd
final_wos_adjusted |>
  filter(!str_detect(WC, paste(relevant_categories, collapse = "|"))) |>
  separate_rows(WC, sep = ";") |>
  count(WC, sort = TRUE) |>
  head(20)
```

## Export to ASReview 

```{r}
# Vérifier la présence des abstracts dans le corpus final
final_filtered |> 
  summarise(
    total_articles = n(),
    has_abstract = sum(!is.na(AB) & AB != ""),
    pct_abstract = round(100 * has_abstract / total_articles, 1)
  )

# Longueur moyenne des abstracts
final_filtered |> 
  filter(!is.na(AB) & AB != "") |> 
  mutate(abstract_length = nchar(AB)) |> 
  summarise(
    mean_length = round(mean(abstract_length)),
    min_length = min(abstract_length),
    max_length = max(abstract_length)
  )

# Aperçu d'un abstract
final_filtered |> 
  filter(!is.na(AB)) |> 
  slice(1) |> 
  pull(AB) |> 
  str_trunc(500)

# Export CSV pour ASReview
final_filtered |> 
  transmute(
    title = TI,
    abstract = AB,
    authors = AU,
    year = PY,
    journal = SO,
    doi = DI,
    keywords = DE,
    notes = paste("Citations:", TC, "| Category:", category)
  ) |> 
  write_csv(here::here("WoS_query_130226", "BRIDGES_asreview.csv"))
```

```{r}
# 1. Document types (exclude editorials, letters, corrections?)
final_filtered |> count(DT, sort = TRUE)

# 2. Language (non-English articles?)
final_filtered |> count(LA, sort = TRUE)

# 3. Missing DOIs (will complicate PDF retrieval later)
final_filtered |> 
  summarise(
    total = n(),
    missing_doi = sum(is.na(DI) | DI == ""),
    pct_missing = round(100 * missing_doi / total, 1)
  )

# 4. The 3 articles without abstracts
final_filtered |> 
  filter(is.na(AB) | AB == "") |> 
  select(TI, PY, SO, DI)

# 5. Potential duplicate titles (different DOIs)
final_filtered |> 
  group_by(TI) |> 
  filter(n() > 1) |> 
  select(TI, PY, SO, DI, TC) |> 
  arrange(TI)
```